#!/bin/bash

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# shellcheck source=/dev/null
. "$SCRIPT_DIR/session_utils.sh"

if ! session_load; then
    printf 'Status: 401 Unauthorized\r\n'
    printf 'Content-type: text/plain\r\n\r\n'
    printf 'Authentication required\n'
    exit 0
fi

# This script will ping 8.8.8.8 and 1.1.1.1 and return the result
# If both pings are successful, it will return "OK"
# If either ping fails, it will return "ERROR"

# Run ping against each target address
if ping -c 1 8.8.8.8 >/dev/null 2>&1 && ping -c 1 1.1.1.1 >/dev/null 2>&1; then
    echo "Content-type: text/plain"
    echo ""
    echo "OK"
else
    echo "Content-type: text/plain"
    echo ""
    echo "ERROR"
fi
