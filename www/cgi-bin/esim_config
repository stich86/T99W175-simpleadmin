#!/bin/bash
set -eu

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
# shellcheck source=/dev/null
. "$SCRIPT_DIR/session_utils.sh"

if ! session_load; then
    send_json_response 401 '{"success":false,"message":"Authentication required"}'
    exit 0
fi

if [ "${SIMPLEADMIN_ENABLE_ESIM:-0}" = "1" ] || [ "${SIMPLEADMIN_ENABLE_ESIM:-0}" = "true" ]; then
    ESIM_ENABLED=1
else
    ESIM_ENABLED=0
fi
ESIM_BASE_URL="${SIMPLEADMIN_ESIM_BASE_URL:-http://localhost:8080/api/v1}"
ESIM_BASE_URL_ESCAPED=$(json_escape "$ESIM_BASE_URL")

payload=$(cat <<JSON
{
  "success": true,
  "data": {
    "enabled": ${ESIM_ENABLED:-0},
    "base_url": "${ESIM_BASE_URL_ESCAPED}"
  }
}
JSON
)

send_json_response 200 "$payload"
